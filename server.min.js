"use strict";function exposeTemplates(e,s,t){hbs.getTemplates("shared/templates/",{cache:app.enabled("view cache"),precompiled:!0}).then(function(e){var a=new RegExp(hbs.extname+"$");e=Object.keys(e).map(function(s){return{name:s.replace(a,""),template:e[s]}}),e.length&&(s.locals.templates=e),setImmediate(t)}).catch(t)}var Promise=global.Promise||require("promise"),path=require("path"),http=require("http"),fs=require("fs"),less=require("less"),express=require("express"),exphbs=require("express-handlebars/"),helpers=require("./lib/helpers"),app=express(),demo_file_path=path.join(__dirname,"source/less/index.less"),strapless_file_path=path.join(__dirname,"source/less/strapless/strapless.less"),css_file_path=path.join(__dirname,"source/less/strapless/strapless-css.less"),hbs=exphbs.create({defaultLayout:"main",helpers:helpers,partialsDir:["shared/templates/","views/partials/"]});app.engine("handlebars",hbs.engine),app.set("view engine","handlebars"),app.use(function(e,s,t){s.header("Access-Control-Allow-Origin","*"),s.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t()}),app.get("/",function(e,s){s.render("home",{title:"Home",styles:"",static_css:!0})}),app.get("/colors",function(e,s){s.render("colors",{title:"Colors",static_css:!0})}),app.get("/patterns",function(e,s){s.render("patterns",{title:"Patterns",static_css:!0})}),app.get("/elements",function(e,s){s.render("elements",{title:"Elements",static_css:!0})});var generateStyles=function(e,s){return new Promise(function(t,a){var r={filename:s,sourceMap:{sourceMapFileInline:!0}};fs.readFile(s,"utf8",function(a,r){if(a)throw a;var n="@base-color: #"+e+";";r+=n;var i={filename:s};less.render(r,i).then(function(e){t(e.css)},function(e){throw a})})})};app.get("/:baseColor?",function(e,s){var t=e.params.baseColor;if(t){var a=/^(?:[0-9a-f]{3}){1,2}$/i.test(t);a?generateStyles(t,demo_file_path).then(function(t){s.render("home",{styles:t,title:e.params.baseColor,static_css:!1})}):s.render("home",{styles:"",static_css:!0,invalid_hex:!0})}else s.render("home",{styles:"",static_css:!0})}),app.get("/democss/:baseColor",function(e,s){generateStyles(e.params.baseColor,demo_file_path).then(function(t){s.header("Content-Disposition","attachment;filename=DEMOCSS_#"+e.params.baseColor+".css"),s.header("Content-type","text/css"),s.send(t)})}),app.get("/css-version/:baseColor",function(e,s){generateStyles(e.params.baseColor,css_file_path).then(function(t){s.header("Content-Disposition","attachment;filename=Strapless_#"+e.params.baseColor+".css"),s.header("Content-type","text/css"),s.send(t)})}),app.use(express.static(path.join(__dirname,"public"))),app.listen(3e3,function(){console.log("Strapless listening on: 3000")});