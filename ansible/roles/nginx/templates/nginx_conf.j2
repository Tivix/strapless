# mysite_nginx.conf

gzip_min_length  1100;
gzip_buffers  4 32k;
gzip_types    text/plain application/x-javascript text/xml text/css;

# the upstream component nginx needs to connect to
upstream django {
    server 127.0.0.1:3031;
}

# configuration of the server
server {
    listen      80;
    server_name {{ server_names }};
    charset     utf-8;

    {% if env != 'dev' %}
    auth_basic "Please log in to proceed";
    auth_basic_user_file /etc/nginx/htpasswd_{{ project_name }};
    {% endif %}

    # max upload size
    client_max_body_size 75M;

    access_log {{ nginx_access_log_file }};
    error_log {{ nginx_error_log_file }};

    # Django media
    location /uploads  {
        alias {{ virtualenv_path }}/uploads;
        expires 1d;
    }

    {% if env != 'dev' %}
    location /static {
        alias {{ virtualenv_path }}/staticserve;
        expires 1d;
    }
    {% else %}
    location /static {
        alias {{ virtualenv_path }}/staticserve;
        expires 1d;
    }
    {% endif %}

    # Finally, send all non-media requests to the Django server.
    location / {
        uwsgi_pass  django;
        include     {{ virtualenv_path }}/uwsgi_params;
    }
}
